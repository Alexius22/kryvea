package api

// func AddVulnerability(c *fiber.Ctx) error {
// 	type reqData struct {
// 		Category           string  `json:"category"`
// 		DetailedTitle      string  `json:"detailed_title"`
// 		CVSSVector         string  `json:"cvss_vector"`
// 		CVSSScore          float32 `json:"cvss_score"`
// 		References         string  `json:"references"`
// 		GenericDescription bool    `json:"generic_description"`
// 		GenericRemediation bool    `json:"generic_remediation"`
// 		Description        string  `json:"description"`
// 		Remediation        string  `json:"remediation"`
// 		TargetID           string  `json:"target_id"`
// 		AssessmentID       string  `json:"assessment_id"`
// 	}

// 	data := &reqData{}
// 	if err := c.BodyParser(data); err != nil {
// 		c.Status(fiber.StatusBadRequest)
// 		return c.JSON(fiber.Map{
// 			"error": "Cannot parse JSON",
// 		})
// 	}

// 	category, err := db.GetCategoryByID(data.Category)
// 	if err != nil {
// 		c.Status(fiber.StatusBadRequest)
// 		return c.JSON(fiber.Map{
// 			"error": "Invalid category",
// 		})
// 	}

// 	if !data.GenericDescription && data.Description == "" {
// 		c.Status(fiber.StatusBadRequest)
// 		return c.JSON(fiber.Map{
// 			"error": "Description is required",
// 		})
// 	}

// 	if !data.GenericRemediation && data.Remediation == "" {
// 		c.Status(fiber.StatusBadRequest)
// 		return c.JSON(fiber.Map{
// 			"error": "Remediation is required",
// 		})
// 	}

// 	_, err = db.GetTargetByID(data.TargetID)
// 	if err != nil {
// 		c.Status(fiber.StatusBadRequest)
// 		return c.JSON(fiber.Map{
// 			"error": "Invalid target ID",
// 		})
// 	}

// 	assessment, err := db.GetAssessmentByID(data.AssessmentID)
// 	if err != nil {
// 		c.Status(fiber.StatusBadRequest)
// 		return c.JSON(fiber.Map{
// 			"error": "Invalid assessment ID",
// 		})
// 	}

// 	cvssScore, err := cvss.ParseVector(data.CVSSVector, assessment.CVSSVersion)
// 	if err != nil {
// 		c.Status(fiber.StatusBadRequest)
// 		return c.JSON(fiber.Map{
// 			"error": "Invalid CVSS vector",
// 		})
// 	}

// 	err = db.AddVulnerability(db.Vulnerability{
// 		Model: db.Model{
// 			ID: uuid.New().String(),
// 		},
// 		CategoryID:         category.ID,
// 		DetailedTitle:      data.DetailedTitle,
// 		CVSSVector:         data.CVSSVector,
// 		CVSSScore:          cvssScore,
// 		References:         data.References,
// 		GenericDescription: data.GenericDescription,
// 		GenericRemediation: data.GenericRemediation,
// 		Description:        data.Description,
// 		Remediation:        data.Remediation,
// 		TargetID:           data.TargetID,
// 		AssessmentID:       data.AssessmentID,
// 	})
// 	if err != nil {
// 		log.Error().Err(err).Msg("Failed to add vulnerability")
// 		c.Status(fiber.StatusBadRequest)
// 		return c.JSON(fiber.Map{
// 			"error": "Cannot add vulnerability",
// 		})
// 	}

// 	c.Status(fiber.StatusOK)
// 	return c.JSON(fiber.Map{
// 		"message": "Vulnerability added",
// 	})
// }
