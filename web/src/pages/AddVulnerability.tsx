import { Form, Formik } from "formik";
import { useEffect, useState } from "react";
import Card from "../components/CardBox/Card";
import Grid from "../components/Composition/Grid";
import CVSS31Wrapper from "../components/CVSS/CVSS31Wrapper/CVSS31Wrapper";
import CVSS40Wrapper from "../components/CVSS/CVSS40Wrapper/CVSS40Wrapper";
import Divider from "../components/Divider";
import Button from "../components/Form/Button";
import Buttons from "../components/Form/Buttons";
import Input from "../components/Form/Input";
import SelectWrapper from "../components/Form/SelectWrapper";
import { SelectOption } from "../components/Form/SelectWrapper.types";
import Textarea from "../components/Form/Textarea";
import { getPageTitle } from "../config";

const AddVulnerability = () => {
  const [VulnerabilitySelectOptions, setVulnerabilitySelectOptions] = useState<SelectOption[]>([
    { label: "v2", value: 0 },
    { label: "v3", value: 1 },
    { label: "v4", value: 2 },
  ]);
  const [selectedVulnerabilityOptions, setSelectedVulnerabilityOptions] = useState<SelectOption | SelectOption[]>(null);
  const [isCvss4, setIsCvss4] = useState(false);

  const [checkedItems, setCheckedItems] = useState({
    gen_desc: true,
    gen_rem: true,
  });

  const handleCheckboxChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { id, checked } = e.target;
    setCheckedItems(prev => ({
      ...prev,
      [id]: checked,
    }));
    console.log(`${id} checked:`, checked);
  };

  useEffect(() => {
    document.title = getPageTitle("Add Vulnerability");
  }, []);

  return (
    <Formik initialValues={{}} onSubmit={undefined}>
      <Form>
        <Card>
          <Grid className="grid-cols-2">
            <SelectWrapper
              label="Vulnerability"
              options={VulnerabilitySelectOptions}
              onChange={selectedOptions => setSelectedVulnerabilityOptions(selectedOptions)}
              defaultValue={{ label: "v2", value: 0 }}
            />
            <Input type="text" id="additional_detail" placeholder="Additional detail" />
            <SelectWrapper
              label="Host"
              id="host-selection"
              options={[
                { value: "127.0.0.1", label: "127.0.0.1" },
                { value: "192.168.1.1", label: "192.168.1.1" },
                { value: "172.0.0.1", label: "172.0.0.1" },
              ]}
              onChange={option => {
                console.log("Selected host:", option.value);
              }}
            />
            <Grid className="gap-5">
              <span className="font-bold">Generic</span>
              <div className="mb-4 flex gap-2">
                <input
                  type="checkbox"
                  id="gen_desc"
                  checked={checkedItems.gen_desc}
                  onChange={handleCheckboxChange}
                  className="h-5 w-5 cursor-pointer"
                />
                <label htmlFor="gen_desc" className="cursor-pointer text-sm">
                  Description
                </label>

                <input
                  type="checkbox"
                  id="gen_rem"
                  checked={checkedItems.gen_rem}
                  onChange={handleCheckboxChange}
                  className="h-5 w-5 cursor-pointer"
                />
                <label htmlFor="gen_rem" className="cursor-pointer text-sm">
                  Remediation
                </label>
              </div>
            </Grid>
          </Grid>
          {!isCvss4 ? <CVSS40Wrapper /> : <CVSS31Wrapper />}
          <Divider />
          <Textarea id="description" label="Description" placeholder="Description here" />
          <Textarea id="remediation" label="Remediation" placeholder="Remediation here" />
          <Textarea id="references" label="References" placeholder="Additional references here" />
          <Divider />
          <Buttons>
            <Button text="Submit" onClick={() => {}} />
            <Button type="secondary" text="Cancel" onClick={() => {}} />
          </Buttons>
        </Card>
      </Form>
    </Formik>
  );
};

export default AddVulnerability;
